services:
  shai:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        SHAI_REF: ${SHAI_REF:-v0.1.0}   # <— ajoute ceci
    # Aucun provider imposé : choisissez via `shai auth`
    volumes:
      - shai_config:/home/shai/.config/shai
      - type: bind
        source: ../.env.example
        target: /home/shai/.env
        read_only: true
    read_only: true
    tmpfs: ["/tmp", "/home/shai/.cache"]
    cap_drop: ["ALL"]
    security_opt: [ "no-new-privileges:true" ]

volumes:
  shai_config:
